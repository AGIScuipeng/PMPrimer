# 扩增子流程化

## 0x0 预想流程
+ 第一步，对原始多序列进行数据清洗，去除大部分的基础错误；
+ 第二步，使用MUSCLE进行多学列比对，对齐序列集合；
+ 第三步，通过香农熵的中断法、窗口延续法挖掘保守区间，从而得到保守区间和非保守区间；
+ 第四步，通过平均香农熵对非保守区间进行评估；
+ 第五步，进行引物设计；
+ 第六步，通过非保守区间的排名和长度生成待选扩增子；
+ 第七步，对扩增子的覆盖度进行评估；
+ 第八步，对扩增子的分辨力进行评估；
+ 第九步，针对扩增子，进行序列差异评估；
+ 第十步，给出选定扩增子，由第六至九步提供的数据和参数的支撑从而更进一步地进行物种鉴定等工作；

## 0x1 流程实现
1. 原始多序列数据清洗还未完成

    具体策略刘老师已经完成，等待了主流程评估后落地

2. 多序列比对
    >目前使用的数据，是刘老师清洗和比对之后的数据，但是MUSCLE已经集成到流程中

    muscle每次release都会发布源代码和Linux、Windows、MacOS下的可执行文件。可以直接将可执行文件打包进工具，根据执行平台直接运行。
    >muscle地址为：[muscle5](https://github.com/rcedgar/muscle)，release地址为：[release of muscle5](https://github.com/rcedgar/muscle/releases)。

    >多序列比对后，muscle会把序列对齐，会在中间增加gap，原始序列可能也有gap（需注意）；

3. 挖掘保守区间和非保守区间

    香农熵公式：
    $$S(X)= \left( -\sum_{x \in X} {p(x)\log_b p(x)} \right) \in [0,1]$$
    其中X为集合，b为集合中元素的个数
    >中断法：当前不符合则退出；

    >窗口延续法：当前和前window平均不符合则退出；

    >后期尝试全0区间拼凑方法。

    挖掘出保守区间后，则剩余的区间视作非保守区间并保存。
    >某位gap占比超过10%则整个保守区间丢掉

4. 平均香农熵

    $$s=\frac{\sum_{i=1} ^{N} {S(i)}} {n} (n \in [1,N])$$
    其中，n为区间香农熵不为0的个数

5. 引物设计

    primer3有python3的调用接口，为primer3-py，但是都是2年以前的代码，有参考和使用价值，但是不知道是否改用primer5，primer5没有python接口。
    >primer3-py，地址为：[github of primer3-py](https://github.com/libnano/primer3-py)

6. 扩增子选定

    根据被保守区间的多样性排名，由高到低并结合区间长度，从而匹配到两端的保守区间，结合选定扩增子。

7. 覆盖度评估

    根据扩增子HaploType个数，结合每个HaploType对应多少样本，累加并算出比例，则为覆盖度。
    >后续要完善对属、种、亚种三个层次的覆盖度评估

8. 分辨力评估

    根据扩增子包含的非保守区间特异性，算出针对属、物种、亚种一共能区分出来多少并算出比例，则为分辨力。
    >后续要完善对种、亚种层次的分辨力评估算法

## 0x2 后续使用
> 评估系统根据扩增子异常识别、覆盖度、分辨能力、差异分析等维度来进行。

## 0x3 流程信息
+ 物种鉴定已经使用Perl完成demo
+ SNP挖掘已经使用Perl完成demo
> 后续不知道是否改由Python重写，或者直接由Python调用Perl